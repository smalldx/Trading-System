# スキャルピング - Radar + Trigger システム

## 概要

このトレーディングシステムは、**早すぎるエントリーを完全に防止**するために、2つのインジケーターで構成されるスキャルピングシステムです。

### システム構成

1. **BespojiMagic_Radar.mq4**（条件検知）
   - トレードセットアップの検知
   - ボリンジャーバンド計算
   - ブレイク検知
   - 条件一致の監視

2. **BespojiMagic_Trigger.mq4**（執行タイミング）
   - 足確定まで強制的に待機
   - カウントダウンタイマー表示
   - 確定した瞬間のみシグナル表示
   - アラート通知

### なぜ2つ必要なのか？

従来の1つのインジケーターでは、**足が確定する前にサインが出てしまい、早すぎるエントリー**をしてしまうリスクがありました。

**Radar + Triggerシステム**では：
- **Radar**: 「条件が揃った」ことを検知（準備段階）
- **Trigger**: 「足が確定した」ことを確認してからシグナル（執行段階）

これにより、**現在の足の値動きに惑わされず、確定した足のみでトレード判断**ができます。

## トレーディングロジック

### Radar（セットアップ検知）

Radarは以下の条件を監視します：

#### 売りセットアップ

1. **安値ブレイク検知**: 価格が過去N本の最安値を下方向にブレイク
2. **ボリンジャーバンド+2σタッチ**: ブレイク後、指定期限内に価格がBB上限（+2σ）にタッチ
3. **陰線確定待ち**:タッチした足が陰線（終値 < 始値）で確定するかを監視

#### 買いセットアップ

1. **高値ブレイク検知**: 価格が過去N本の最高値を上方向にブレイク
2. **ボリンジャーバンド-2σタッチ**: ブレイク後、指定期限内に価格がBB下限（-2σ）にタッチ
3. **陽線確定待ち**: タッチした足が陽線（終値 > 始値）で確定するかを監視

### Trigger（執行タイミング）

Triggerは以下を実行します：

1. **Radarの監視**: iCustom関数でRadarのセットアップ状態を取得
2. **カウントダウン表示**: 現在の足が確定するまでの残り時間を大きく表示
3. **足確定確認**: 新しい足が形成された瞬間＝前の足が確定した瞬間を検知
4. **シグナル表示**: Radarが条件を検知し、かつ足が確定した場合のみ矢印とアラート

## インストール方法

### ステップ1: ファイルの配置

1. MT4を開き、メニューから **ファイル → データフォルダを開く** を選択
2. `MQL4` → `Indicators` フォルダを開く
3. 以下の2つのファイルをこのフォルダにコピー：
   - `BespojiMagic_Radar.mq4`
   - `BespojiMagic_Trigger.mq4`

### ステップ2: MT4の再起動

1. MT4を完全に終了
2. MT4を再起動

### ステップ3: インジケーターの適用

#### Radarの適用（必須）

1. ナビゲーターウィンドウ（Ctrl+N）を開く
2. **インディケータ** → **カスタム** を展開
3. `BespojiMagic_Radar` を5分足チャートにドラッグ&ドロップ
4. パラメータを設定（デフォルトでOK）
5. **OK** をクリック

#### Triggerの適用（必須）

1. 同じチャートに `BespojiMagic_Trigger` をドラッグ&ドロップ
2. パラメータはRadarと同じ値に設定する必要があります（重要！）
3. **OK** をクリック

> [!IMPORTANT]
> RadarとTriggerのパラメータ（BB_Period、Lookback_Period等）は**必ず同じ値**に設定してください。
> パラメータが異なると、Radarの検知とTriggerの実行がずれてしまいます。

## 使用方法

### 基本的な使用手順

1. **Radarが条件検知**
   - チャート上でRadarが条件を満たすと、準備が整います
   - この時点では**まだエントリーしない**

2. **Triggerのカウントダウンを確認**
   - 画面右上に「【足確定まで】X:XX」とカウントダウンが表示されます
   - 残り時間が10秒以下になると赤色で警告表示

3. **足確定を待つ**
   - カウントダウンが0になり、新しい足が形成されるまで待ちます
   - **絶対に早くクリックしない**

4. **Triggerがシグナル表示**
   - 足が確定し、Radarの条件を満たしている場合のみ矢印が表示されます
   - アラートが鳴ります

5. **エントリー**
   - この瞬間が唯一のエントリータイミングです
   - 次の足の始値でエントリー

### カウントダウンタイマーの見方

```
【足確定まで】 3:45
```
- **緑/白 → まだ余裕あり**: 待機してください
- **赤（10秒以内） → もうすぐ**: 準備してください

```
【準備】間もなくエントリー可能
```
- 残り3秒以内で表示
- 足が確定する直前

## パラメータ設定

### Radarパラメータ

Radarは従来のBespojiMagicScalpingと同じパラメータを持ちます。
詳細は後述の「完全なパラメータリスト」を参照してください。

### Triggerパラメータ

#### Radar連携設定

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| `Radar_Indicator_Name` | "BespojiMagic_Radar" | Radarインジケーターの名前 |

> [!NOTE]
> Radarの名前を変更した場合のみ、このパラメータを変更してください。

#### カウントダウンタイマー設定

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| `Timer_Color` | White（白） | タイマー通常時の色 |
| `Timer_Warning_Color` | Red（赤） | タイマー警告時の色（10秒以内） |
| `Timer_FontSize` | 24 | タイマーの文字サイズ |
| `Timer_X_Distance` | 200 | タイマーのX位置（画面右端からの距離） |
| `Timer_Y_Distance` | 50 | タイマーのY位置（画面上端からの距離） |

#### 矢印表示設定（Trigger）

| パラメータ | デフォルト値 | 説明 |
|-----------|------------|------|
| `Trigger_Buy_Arrow_Color` | Lime（緑） | 買いシグナル矢印色 |
| `Trigger_Sell_Arrow_Color` | Red（赤） | 売りシグナル矢印色 |
| `Trigger_Arrow_Size` | 3 | 矢印サイズ（Radarより大きめ） |

## トレード例

### シナリオ: EURUSD 5分足

#### 時刻 10:52（セットアップ検知）

- Radarが高値ブレイク → BB-2σタッチを検知
- 現在の足は陽線になりつつある
- **しかしまだ確定していない**

#### 時刻 10:53〜10:54（待機）

- Triggerカウントダウン: 「【足確定まで】1:15」
- **あなたは待つ**
- カウントダウンを見ながら、早くクリックしたい衝動を抑える

#### 時刻 10:54:50（警告）

- Triggerカウントダウン: 「【足確定まで】0:10」（赤色）
- ステータス: 「【準備】間もなくエントリー可能」
- **準備はするが、まだクリックしない**

#### 時刻 10:55:00（足確定＝シグナル）

- 新しい足が形成される
- Triggerが矢印を表示：「▲」
- アラート: 「【TRIGGER】べすぽじの魔術: 買いシグナル 確定！」
- **この瞬間にエントリー**

## トラブルシューティング

### Triggerのシグナルが出ない

**原因と対処:**
1. Radarが適用されていない → Radarを先に適用
2. パラメータがずれている → RadarとTriggerのパラメータを一致させる
3. Radarの名前が違う → `Radar_Indicator_Name`パラメータを確認

### カウントダウンが表示されない

**原因と対処:**
1. Triggerが適用されていない → Triggerを適用
2. 画面外に表示されている → `Timer_X_Distance`と`Timer_Y_Distance`を調整

### Radarとシグナルが一致しない

**症状**: Radarで矢印が見えるのに、Triggerでシグナルが出ない

**原因**: Radarは条件を満たした足に矢印を描画しますが、Triggerは「足が確定した」ことを重視します。

**対処**: これは正常動作です。Radarの矢印は参考程度にし、Triggerのシグナルを信頼してください。

## メリットとデメリット

### ✅ メリット

1. **早すぎるエントリーを完全防止**
2. **感情的なトレードを抑制**（カウントダウンが強制的に待たせる）
3. **明確なエントリータイミング**（足確定のみ）
4. **バックテスト可能**（確定足のみなので再現性が高い）

### ⚠️ 注意点

1. **2つのインジケーターが必要**（片方だけでは動作しない）
2. **パラメータを2回設定**する手間
3. **チャートがやや重くなる**（2つのインジケーター稼働）

## システム要件

- **MT4**: Build 1170以降推奨
- **CPU**: 通常のトレード用PCで十分
- **メモリ**: 特別な要件なし
- **タイムフレーム**: 5分足専用（他でも動作するが推奨外）

## よくある質問（FAQ）

### Q1: Radarだけでもトレードできますか？

A: **できません（非推奨）**。Radarは条件検知だけで、足が確定する前にもシグナルを出してしまいます。Triggerと組み合わせることで初めて実用的になります。

### Q2: TriggerだけでもOKですか？

A: **できません**。TriggerはRadarのデータを必要とします。

### Q3: パラメータを毎回2回設定するのが面倒です

A: MT4の「テンプレート機能」を使用してください。一度設定したら、テンプレートとして保存し、次回から読み込むだけで済みます。

### Q4: カウントダウンがうるさいです

A: `Timer_FontSize`を小さくするか、`Timer_X_Distance`/`Timer_Y_Distance`で画面の端に移動させてください。

## 免責事項

> [!CAUTION]
> このインジケーターはトレード判断の補助ツールです。
> 
> - 投資判断は自己責任で行ってください
> - 過去の成績は将来の利益を保証するものではありません
> - デモ口座で十分にテストしてから実運用してください
> - リスク管理を徹底し、許容できる範囲内で取引してください

## サポート

ご質問や改善要望がございましたら、お気軽にお問い合わせください。

---

**システムバージョン**: 2.00 (Radar + Trigger)  
**最終更新日**: 2026年1月14日
